pkgname=pipelam-git
_pkgname=pipelam
pkgver=v0.1.9.r1.g51c93a1 # Set by pkgver()
pkgrel=1
pkgdesc="A lightweight GTK4-based notification system for displaying text, images, and progress bars"
arch=('x86_64' 'aarch64')
url="https://github.com/thomascrha/pipelam"
license=('MIT')
depends=('gtk4' 'gtk4-layer-shell')
makedepends=('clang' 'make' 'scdoc' 'git')
optdepends=('systemd: for systemd socket activation')
provides=("${_pkgname}")
conflicts=("${_pkgname}")
# source=("$_pkgname::git+$url.git")
source=(git+file:///home/tcrha/Projects/pipelam)
sha256sums=('SKIP')

pkgver() {
  cd "$_pkgname"
  git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

build() {
    cd "$_pkgname"
    make build
    make docs
}

package() {
    cd "$_pkgname"
    make PREFIX="$pkgdir" install

    # Install license
    install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$_pkgname/LICENSE"

    make PREFIX="$pkgdir" install-systemd

    # # Install config file
    install -d "$pkgdir/etc/$_pkgname"
    install -Dm644 config/pipelam.toml "$pkgdir/etc/$_pkgname/pipelam.toml"
}

